{
  "ignition": {
    "config": {
      "merge": [
        {
          "source": "${ignition_url}"%{ if ignition_cacert == "" },
          "verification": {}%{ endif }
        }
      ]
    },%{ if ignition_cacert != "" }
    "security": {
      "tls": {
        "certificateAuthorities": [
          {
            "source": "${ignition_cacert}"
          }
        ]
      }
    },%{ endif }
    "timeouts": {},
    "version": "3.0.0"
  },
  "networkd": {},
  "passwd": {},
  "storage": {
    "files": [
      {
        "filesystem": "root",
        "group": {},
        "path": "/etc/hostname",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,${hostname_b64}",
          "verification": {}
        },
        "mode": 420,
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "name": "set-hostname-firstboot.service",
        "enabled": true,
        "contents": "[Unit]\nConditionFirstBoot=yes\n[Service]\nType=idle\nExecStart=/usr/bin/hostnamectl set-hostname ${hostname}\n[Install]\nWantedBy=multi-user.target\n",
      },
      {
        "name": "set-nameservers.service",
        "enabled": true,
        "contents: {
          "source": "data:text/plain;charset=utf-8;base64,W1VuaXRdXG5EZXNjcmlwdGlvbj1zZXQtbmFtZXNlcnZlcnNcbkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldFxuXG5bU2VydmljZV1cblR5cGU9b25lc2hvdFxuXG5FeGVjU3RhcnQ9L2Jpbi9iYXNoIC1jICdlY2hvIC1lICJbbWFpbl1cXG5kbnM9bm9uZSIgPiAvZXRjL05ldHdvcmtNYW5hZ2VyL2NvbmYuZC85MC1kbnMtbm9uZS5jb25mOyBybSAtZiAvZXRjL3Jlc29sdi5jb25mOyBlY2hvIC1lICJzZWFyY2ggb3MuYm9yZGVtYW5uLmNvbVxcbm5hbWVzZXJ2ZXIgMS4xLjEuMVxcbm5hbWVzZXJ2ZXIgMS4wLjAuMSIgPiAvZXRjL3Jlc29sdi5jb25mOyAvdXNyL2Jpbi9zeXN0ZW1jdGwgcmVsb2FkIE5ldHdvcmtNYW5hZ2VyJ1xuXG5bSW5zdGFsbF1cbldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0XG4=",
          "verification" : {}
        }
      }
    ]
  }
}
